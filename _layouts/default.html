<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>

  {%- seo -%}

  <link rel="stylesheet" href="{{ "/assets/css/custom.css" | relative_url }}" />

  <!-- MathJax v3 config -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true,
        tags: 'ams',                         // equation numbering like \tag, \label, \ref
        packages: {'[+]': ['noerrors']}      // avoid throwing visible errors on the page
      },
      options: {
        skipHtmlTags: ['script','noscript','style','textarea','pre','code'] // don't typeset inside code blocks
      }
    };
  </script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    /* Optional: keep MathJax font size aligned with body text */
    mjx-container[jax="CHTML"] { font-size: 100%; }
  </style>
</head>

<body>
  {% assign active_section = nil %}
  {% if page.path contains "probability/" %}
    {% assign active_section = "probability" %}
  {% elsif page.path contains "research/" %}
    {% assign active_section = "research" %}
  {% elsif page.path contains "fiction/" %}
    {% assign active_section = "fiction" %}
  {% endif %}
  {% assign active_subsection = nil %}
  {% if active_section %}
    {% assign subsection_segments = page.path | remove_first: active_section | remove_first: "/" | split: "/" %}
    {% assign active_subsection = subsection_segments | first %}
  {% endif %}
  {% assign nav_sections = "probability:Probability,research:Research,fiction:Fiction" | split: "," %}

  <div class="layout">
    <aside class="sidebar" id="lectureSidebar">
      <div class="sidebar__header">
        <span>Navigation</span>
        <a class="sidebar__reset" href="#" id="sidebarReset" title="Reset width">Reset</a>
      </div>
      <ul class="nav-list">
        <li>
          <a class="{% if page.url == "/" or page.url == "/index.html" %}active{% endif %}"
             href="{{ "/" | relative_url }}">Blog</a>
        </li>
        <li>
          <a class="{% if page.url == "/about.html" %}active{% endif %}"
             href="{{ "/about.html" | relative_url }}">About</a>
        </li>
        {% for entry in nav_sections %}
          {% assign parts = entry | split: ":" %}
          {% assign section_key = parts[0] | strip %}
          {% assign section_label = parts[1] | strip %}
          {% assign section_prefix = section_key | append: "/" %}
          {% assign section_id = "nav-" | append: section_key %}
          {% assign is_section_active = false %}
          {% if active_section == section_key %}
            {% assign is_section_active = true %}
          {% endif %}

          {% assign section_readme = section_prefix | append: 'README.md' %}
          {% assign section_index_md = section_prefix | append: 'index.md' %}
          {% assign section_index_html = section_prefix | append: 'index.html' %}
          {% assign section_landing = site.pages | where_exp: "p", "p.path == section_readme" | first %}
          {% if section_landing == nil %}
            {% assign section_landing = site.pages | where_exp: "p", "p.path == section_index_md" | first %}
          {% endif %}
          {% if section_landing == nil %}
            {% assign section_landing = site.pages | where_exp: "p", "p.path == section_index_html" | first %}
          {% endif %}
          {% assign section_url = section_landing.url | default: section_prefix %}

          {% assign section_pages = site.pages | where_exp: "p", "p.path contains section_prefix" %}
          {% assign subsection_pages = section_pages | where_exp: "p", "p.path | remove_first: section_prefix | split: '/' | size > 1" %}
          {% assign subsections = subsection_pages | group_by_exp: "p", "p.path | remove_first: section_prefix | split: '/' | first" | sort: "name" %}

          <li class="nav__section{% if is_section_active %} is-open{% endif %}">
            <div class="nav__section-row">
              <a class="nav__section-link{% if is_section_active %} active{% endif %}"
                 href="{{ section_url | relative_url }}">{{ section_label }}</a>
              <button class="nav__toggle" type="button"
                      aria-expanded="{% if is_section_active %}true{% else %}false{% endif %}"
                      aria-controls="{{ section_id }}"
                      data-toggle-target="{{ section_id }}">
                <span class="nav__toggle-icon">&gt;</span>
              </button>
            </div>
            <ul id="{{ section_id }}"
                class="nav__sublist{% unless is_section_active %} is-collapsed{% endunless %}">
              {% for subsection in subsections %}
                {% assign subgroup = subsection.name %}
                {% if subgroup == "" %}{% continue %}{% endif %}
                {% if subgroup == "README.md" or subgroup == "index.md" or subgroup == "index.html" %}{% continue %}{% endif %}

                {% assign sub_prefix = section_prefix | append: subgroup | append: "/" %}
                {% assign sub_id = section_id | append: "-" | append: subgroup | slugify %}
                {% assign is_sub_active = false %}
                {% if is_section_active and page.path contains sub_prefix %}
                  {% assign is_sub_active = true %}
                {% endif %}
                {% assign sub_label = subgroup | replace: "-", " " | replace: "_", " " %}

                {% assign sub_readme = sub_prefix | append: 'README.md' %}
                {% assign sub_index_md = sub_prefix | append: 'index.md' %}
                {% assign sub_index_html = sub_prefix | append: 'index.html' %}
                {% assign sub_landing = site.pages | where_exp: "p", "p.path == sub_readme" | first %}
                {% if sub_landing == nil %}
                  {% assign sub_landing = site.pages | where_exp: "p", "p.path == sub_index_md" | first %}
                {% endif %}
                {% if sub_landing == nil %}
                  {% assign sub_landing = site.pages | where_exp: "p", "p.path == sub_index_html" | first %}
                {% endif %}
                {% assign sub_url = sub_landing.url | default: sub_prefix %}

                {% assign pages = subsection.items | sort_natural: "path" %}
                <li class="nav__subsection{% if is_sub_active %} is-open{% endif %}">
                  <div class="nav__subsection-row">
                    <a class="nav__subsection-link{% if is_sub_active %} active{% endif %}"
                       href="{{ sub_url | relative_url }}">{{ sub_label }}</a>
                    <button class="nav__toggle nav__toggle--small" type="button"
                            aria-expanded="{% if is_sub_active %}true{% else %}false{% endif %}"
                            aria-controls="{{ sub_id }}"
                            data-toggle-target="{{ sub_id }}">
                      <span class="nav__toggle-icon">&gt;</span>
                    </button>
                  </div>
                  <ul id="{{ sub_id }}"
                      class="nav__page-list{% unless is_sub_active %} is-collapsed{% endunless %}">
                    {% for subpage in pages %}
                      {% assign filename = subpage.name %}
                      {% if filename == "README.md" or filename == "index.md" or filename == "index.html" %}{% continue %}{% endif %}

                      {% assign label = subpage.title | default: subpage.data.title | default: filename %}
                      {% assign label = label | replace: ".html", "" | replace: ".md", "" | replace: "_", " " | replace: "-", " " %}
                      <li>
                        <a class="{% if subpage.url == page.url %}active{% endif %}"
                           href="{{ subpage.url | default: subpage.path | relative_url }}">
                          {{ label }}
                        </a>
                      </li>
                    {% endfor %}
                  </ul>
                </li>
              {% endfor %}
            </ul>
          </li>
        {% endfor %}
      </ul>
    </aside>
    <div class="sidebar-resizer" id="sidebarResizer" role="separator" aria-orientation="vertical" aria-label="Resize navigation"></div>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        {{ content }}
      </div>
    </main>
  </div>

  <footer class="site-footer">
    <small>&copy; {{ site.time | date: "%Y" }} {{ site.author | default: site.title }}</small>
  </footer>

  <style>
    :root {
      --sidebar-width: 240px;
      --sidebar-min: 180px;
      --sidebar-max: 520px;
    }
    .layout {
      display: grid;
      grid-template-columns: var(--sidebar-width) 6px 1fr;
      gap: 0;
    }
    .sidebar {
      background: #f7f7f7;
      border: 1px solid #dfe2e5;
      border-radius: 8px;
      padding: 0.75rem;
      width: 100%;
      max-width: 100%;
      min-width: var(--sidebar-min);
      box-sizing: border-box;
      overflow-y: auto;
      position: sticky;
      top: 0.75rem;
      align-self: start;
      height: calc(100vh - 4rem);
    }
    .sidebar__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    .sidebar__reset {
      font-size: 0.85rem;
      text-decoration: none;
      color: #159957;
    }
    .sidebar__reset:hover,
    .sidebar__reset:focus-visible {
      text-decoration: underline;
    }
    .nav-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }
    .nav-list > li > a {
      text-decoration: none;
      color: inherit;
      padding: 0.25rem 0.35rem;
      border-radius: 6px;
      display: block;
      font-weight: 600;
    }
    .nav-list > li > a.active {
      background: #159957;
      color: #fff;
    }
    .nav__section {
      border: 1px solid #dfe2e5;
      border-radius: 8px;
      background: #ffffff;
    }
    .nav__section-row,
    .nav__subsection-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.5rem;
      padding: 0.35rem 0.45rem;
    }
    .nav__section-row {
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.95rem;
      letter-spacing: 0.04em;
    }
    .nav__section-link,
    .nav__subsection-link {
      text-decoration: none;
      color: inherit;
      flex: 1;
      border-radius: 6px;
      padding: 0.25rem 0.3rem;
    }
    .nav__section-link.active,
    .nav__subsection-link.active {
      background: #e6f3ec;
      color: #0c6d3f;
    }
    .nav__sublist,
    .nav__page-list {
      list-style: none;
      padding: 0 0.45rem 0.45rem;
      margin: 0;
    }
    .nav__sublist {
      border-top: 1px solid #e7ebf0;
    }
    .nav__subsection {
      border: 1px solid #e7ebf0;
      border-radius: 6px;
      margin-top: 0.35rem;
      background: #f9fafc;
    }
    .nav__page-list {
      padding-left: 0.85rem;
      border-left: 2px solid #e0e5ec;
    }
    .nav__page-list a {
      text-decoration: none;
      color: inherit;
      padding: 0.25rem 0.3rem;
      display: block;
      border-radius: 5px;
      font-size: 0.95rem;
    }
    .nav__page-list a:hover,
    .nav__page-list a:focus-visible {
      background: #e6f3ec;
      color: #0c6d3f;
    }
    .nav__page-list a.active {
      background: #159957;
      color: #fff;
    }
    .nav__toggle {
      border: 1px solid #dfe2e5;
      background: #fff;
      color: #5c6f82;
      width: 28px;
      height: 28px;
      border-radius: 6px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: border-color 0.2s ease, background 0.2s ease;
    }
    .nav__toggle:hover,
    .nav__toggle:focus-visible {
      background: #e6f3ec;
      border-color: #159957;
    }
    .nav__toggle--small {
      width: 26px;
      height: 26px;
      font-size: 0.8rem;
    }
    .nav__toggle-icon {
      display: inline-block;
      transition: transform 0.2s ease;
    }
    .nav__section.is-open > .nav__section-row .nav__toggle-icon,
    .nav__subsection.is-open > .nav__subsection-row .nav__toggle-icon {
      transform: rotate(90deg);
    }
    .is-collapsed {
      display: none;
    }
    .sidebar-resizer {
      width: 6px;
      cursor: col-resize;
      background: transparent;
      position: relative;
    }
    .sidebar-resizer::after {
      content: "";
      position: absolute;
      top: 0;
      bottom: 0;
      left: 2px;
      width: 2px;
      background: #dfe2e5;
      border-radius: 2px;
    }
    .page-content {
      width: 100%;
    }
    @media (max-width: 819px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .sidebar,
      .sidebar-resizer {
        display: none;
      }
    }
  </style>

  <script>
    (function() {
      var sidebar = document.getElementById('lectureSidebar');
      var resizer = document.getElementById('sidebarResizer');
      var resetBtn = document.getElementById('sidebarReset');
      if (!sidebar || !resizer) return;

      var stored = localStorage.getItem('sttSidebarWidth');
      if (stored) {
        sidebar.style.width = stored;
      }

      var startX = 0;
      var startWidth = 0;
      function onMouseMove(e) {
        var delta = e.clientX - startX;
        var minW = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-min'));
        var maxW = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--sidebar-max'));
        var newWidth = Math.min(Math.max(startWidth + delta, minW), maxW);
        sidebar.style.width = newWidth + 'px';
      }
      function onMouseUp() {
        localStorage.setItem('sttSidebarWidth', sidebar.style.width);
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      }
      resizer.addEventListener('mousedown', function(e) {
        startX = e.clientX;
        startWidth = sidebar.getBoundingClientRect().width;
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      });
      if (resetBtn) {
        resetBtn.addEventListener('click', function(e) {
          e.preventDefault();
          sidebar.style.width = getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width');
          localStorage.removeItem('sttSidebarWidth');
        });
      }
    })();

    (function() {
      var toggles = document.querySelectorAll('[data-toggle-target]');
      toggles.forEach(function(btn) {
        btn.addEventListener('click', function() {
          var targetId = btn.getAttribute('data-toggle-target');
          var target = document.getElementById(targetId);
          if (!target) return;

          var isCollapsed = target.classList.toggle('is-collapsed');
          var expanded = !isCollapsed;
          btn.setAttribute('aria-expanded', expanded);

          var parentSection = btn.closest('.nav__section, .nav__subsection');
          if (parentSection) {
            parentSection.classList.toggle('is-open', expanded);
          }
        });
      });
    })();
  </script>
</body>
</html>
