---
title: "2021-Q3: Compensators for counting processes, martingale and Doob decomposition"
permalink: /probability/prelim/2021q3/
tags: [probability-prelim, martingales, doob-decomposition]
---

## Short introduction

This problem is testing:

- Whether you can recognize the â€œindicator sum minus conditional meanâ€ trick as a martingale construction.
- Whether you can do a clean Doob decomposition of a submartingale built from event indicators.
- Whether you can do the standard â€œsquare a martingale and subtract conditional variancesâ€ martingale, and then use that to decompose the square.

Main tools you likely need:

- Martingale definition: adapted, integrable, and the tower property for conditional expectations.
- Predictable / previsible processes: objects measurable w.r.t. the previous sigma algebra.
- Doob decomposition: submartingale = martingale + predictable increasing process.
- The identity for martingale differences:
  $$
  X_n = X_{n-1} + D_n,\quad D_n := X_n - X_{n-1},
  $$
  and then
  $$
  X_n^2 = X_{n-1}^2 + 2X_{n-1}D_n + D_n^2,
  $$
  taking conditional expectations kills the cross term because $E[D_n\mid \mathcal F_{n-1}] = 0$.

Pattern recognition cues:

- Anytime you see $\sum_{k\le n} \mathbf 1_{B_k}$ and you subtract $\sum_{k\le n} E[\mathbf 1_{B_k}\mid \mathcal F_{k-1}]$, you should immediately suspect: â€œthis is a martingale with martingale differences $\mathbf 1_{B_n} - p_n(B_n)$.â€
- The expression $p - p^2$ is the conditional variance of a Bernoulli($p$) random variable.

---

## Problem statement (verbatim)

Problem 3. In what follows n = 1, 2, â€¦  
Let {ğµğ‘›} be a sequence of events and { â„±ğ‘›} be a sequence of increasing ğœ algebras and assume that ğµğ‘› âˆˆ â„±ğ‘›.  
Let ğ‘Œğ‘› = âˆ‘ 1_{ğµğ‘˜} (k=1 to n) and ğ‘‹ğ‘› = ğ‘Œğ‘› âˆ’ âˆ‘ ğ‘ğ‘˜(ğµğ‘˜) (k=1 to n), where  
ğ‘ğ‘˜(ğµğ‘˜) = ğ¸(1_{ğµğ‘˜} |â„±_{ğ‘˜âˆ’1}).  

a. (i) Prove that {ğ‘‹ğ‘› , â„±ğ‘›} is a martingale.  
(ii) Prove that {ğ‘Œğ‘› , â„±ğ‘›} is a submartingale and show its Doobâ€™s decomposition.  

b. Prove that {ğ‘‹ğ‘›^2 âˆ’ âˆ‘ (ğ‘ğ‘˜(ğµğ‘˜) âˆ’ ğ‘ğ‘˜^2(ğµğ‘˜)) (k=1 to n), â„±ğ‘›} is a martingale.  
Hint: Observe that âˆ‘ (ğ‘ğ‘˜(ğµğ‘˜) âˆ’ ğ‘ğ‘˜^2(ğµğ‘˜)) (k=1 to n) is â„±_{ğ‘›âˆ’1} measurable.  

c. (i). Prove that {ğ‘‹ğ‘›^2, â„±ğ‘›} is a submartingale.  
(ii). Show the Doobâ€™s decomposition of {ğ‘‹ğ‘›^2, â„±ğ‘›}.  

---

## Setup and notation

We are given:

- Events $B_n$ with $B_n \in \mathcal F_n$.
- Increasing filtration $(\mathcal F_n)_{n\ge 0}$.
- Counting-type process
  $$
  Y_n := \sum_{k=1}^n \mathbf 1_{B_k}.
  $$
- Conditional probabilities (really conditional expectations)
  $$
  p_k(B_k) := E[\mathbf 1_{B_k}\mid \mathcal F_{k-1}],
  $$
  so $p_k(B_k)$ is $\mathcal F_{k-1}$-measurable and satisfies $0\le p_k(B_k)\le 1$ a.s.
- Compensated process
  $$
  X_n := Y_n - \sum_{k=1}^n p_k(B_k)
      = \sum_{k=1}^n\Big(\mathbf 1_{B_k}-p_k(B_k)\Big).
  $$

A useful martingale-difference notation (this is the â€œwind readingâ€ here):

$$
D_n := X_n - X_{n-1} = \mathbf 1_{B_n} - p_n(B_n).
$$

Then automatically:

- $D_n$ is $\mathcal F_n$-measurable (since $B_n\in \mathcal F_n$ and $p_n(B_n)\in \mathcal F_{n-1}\subseteq \mathcal F_n$).
- $E[D_n\mid \mathcal F_{n-1}] = 0$.

---

# Part (a)(i): $\{X_n,\mathcal F_n\}$ is a martingale

### Claim
$\{X_n,\mathcal F_n\}$ is a martingale.

### Proof

We check the three martingale requirements.

**1. Adaptedness.**  
Your structure is correct, but I will rewrite it slightly cleaner:

$$
X_n
= \sum_{k=1}^n \mathbf 1_{B_k} - \sum_{k=1}^n p_k(B_k).
$$

- Each $\mathbf 1_{B_k}$ is $\mathcal F_k$-measurable, hence $\mathcal F_n$-measurable for $k\le n$ because the filtration is increasing.
- Each $p_k(B_k)=E[\mathbf 1_{B_k}\mid \mathcal F_{k-1}]$ is $\mathcal F_{k-1}$-measurable, hence also $\mathcal F_n$-measurable for $k\le n$.

So $X_n$ is $\mathcal F_n$-measurable.

**2. Integrability.**  
A clean bound is:

$$
|X_n|
= \left|\sum_{k=1}^n (\mathbf 1_{B_k}-p_k(B_k))\right|
\le \sum_{k=1}^n |\mathbf 1_{B_k}-p_k(B_k)|.
$$

But $\mathbf 1_{B_k}\in\{0,1\}$ and $p_k(B_k)\in[0,1]$, so
$$
|\mathbf 1_{B_k}-p_k(B_k)|\le 1.
$$
Thus
$$
|X_n|\le \sum_{k=1}^n 1 = n,
\quad\text{so}\quad
E|X_n|\le n<\infty.
$$

(Your handwritten attempt was heading here, the key fix is: do not write $E|X_n|\le E[X_n]$, since $X_n$ can be negative. Use $|\cdot|\le$ sum of absolute values instead.)

**3. Martingale property.**  
Compute $E[X_n\mid \mathcal F_{n-1}]$. Split off the last term exactly like you did:

$$
X_n
= \sum_{k=1}^{n-1} (\mathbf 1_{B_k}-p_k(B_k)) + (\mathbf 1_{B_n}-p_n(B_n))
= X_{n-1} + (\mathbf 1_{B_n}-p_n(B_n)).
$$

Now condition on $\mathcal F_{n-1}$:

$$
E[X_n\mid \mathcal F_{n-1}]
= E[X_{n-1}\mid \mathcal F_{n-1}] + E[\mathbf 1_{B_n}-p_n(B_n)\mid \mathcal F_{n-1}].
$$

- $X_{n-1}$ is $\mathcal F_{n-1}$-measurable, so $E[X_{n-1}\mid \mathcal F_{n-1}] = X_{n-1}$.
- $p_n(B_n)$ is $\mathcal F_{n-1}$-measurable, so
  $$
  E[\mathbf 1_{B_n}-p_n(B_n)\mid \mathcal F_{n-1}]
  = E[\mathbf 1_{B_n}\mid \mathcal F_{n-1}] - p_n(B_n)
  = p_n(B_n)-p_n(B_n)=0.
  $$

Therefore $E[X_n\mid \mathcal F_{n-1}] = X_{n-1}$.

This verifies all three properties, so $\{X_n,\mathcal F_n\}$ is a martingale.

### Conclusion
$\{X_n,\mathcal F_n\}$ is a martingale.

### Key takeaway

- The â€œcompensated counting processâ€ trick:
  $$
  \sum_{k=1}^n \mathbf 1_{B_k} \;-\; \sum_{k=1}^n E[\mathbf 1_{B_k}\mid \mathcal F_{k-1}]
  $$
  is almost always a martingale, with differences $\mathbf 1_{B_n}-E[\mathbf 1_{B_n}\mid \mathcal F_{n-1}]$.
- For integrability, do not try to compare $E|X_n|$ with $EX_n$ unless you know $X_n\ge 0$. Use $|\sum|\le \sum|\cdot|$ and $|\mathbf 1 - p|\le 1$.

---

# Part (a)(ii): $\{Y_n,\mathcal F_n\}$ is a submartingale, and its Doob decomposition

### Claim
$\{Y_n,\mathcal F_n\}$ is a submartingale, and its Doob decomposition is
$$
Y_n = X_n + A_n,\qquad A_n := \sum_{k=1}^n p_k(B_k),
$$
where $X_n$ is the martingale from part (a)(i), and $A_n$ is predictable and increasing with $A_0=0$.

### Proof

**1. Adaptedness.**  
$Y_n=\sum_{k=1}^n \mathbf 1_{B_k}$ is $\mathcal F_n$-measurable because each $B_k\in \mathcal F_k\subseteq \mathcal F_n$.

**2. Integrability.**  
Here your argument works because $Y_n\ge 0$:

$$
E|Y_n| = EY_n = E\left[\sum_{k=1}^n \mathbf 1_{B_k}\right]\le \sum_{k=1}^n E[1]=n<\infty.
$$

**3. Submartingale inequality.**  
Compute $E[Y_n\mid \mathcal F_{n-1}]$. Again, split the last term:

$$
Y_n = \sum_{k=1}^{n-1}\mathbf 1_{B_k} + \mathbf 1_{B_n} = Y_{n-1} + \mathbf 1_{B_n}.
$$

Then
$$
E[Y_n\mid \mathcal F_{n-1}]
= Y_{n-1} + E[\mathbf 1_{B_n}\mid \mathcal F_{n-1}]
= Y_{n-1} + p_n(B_n)
\ge Y_{n-1}.
$$

So $\{Y_n\}$ is a submartingale.

**Doob decomposition.**  
We already have the identity (your key insight):

$$
X_n = Y_n - \sum_{k=1}^n p_k(B_k)
\quad\Longleftrightarrow\quad
Y_n = X_n + \sum_{k=1}^n p_k(B_k).
$$

Define
$$
A_n := \sum_{k=1}^n p_k(B_k).
$$

Now check the properties for the compensator $A_n$:

- $A_0=0$ (empty sum).
- $A_n$ is increasing because each summand $p_k(B_k)\ge 0$.
- $A_n$ is predictable (previsible) because
  $$
  A_n - A_{n-1} = p_n(B_n) \in \mathcal F_{n-1}.
  $$
  Equivalently, $A_n$ is $\mathcal F_{n-1}$-measurable for each $n\ge 1$ if you view it as a process with predictable increments.

Thus $Y_n = X_n + A_n$ is precisely the Doob decomposition.

### Conclusion
$\{Y_n,\mathcal F_n\}$ is a submartingale and has Doob decomposition $Y_n=X_n+A_n$ with $A_n=\sum_{k=1}^n p_k(B_k)$.

### Key takeaway

- In discrete time, Doob decomposition is usually found by spotting the predictable conditional drift:
  $$
  E[Y_n-Y_{n-1}\mid \mathcal F_{n-1}] = p_n(B_n).
  $$
  Then $A_n = \sum_{k\le n} p_k(B_k)$ and the remainder is the martingale part.
- A â€œcounting processâ€ $Y_n=\sum \mathbf 1_{B_k}$ always has drift $p_n(B_n)$ and martingale difference $\mathbf 1_{B_n}-p_n(B_n)$.

---

# Part (b): the squared-compensated martingale

Define
$$
M_n := X_n^2 - \sum_{k=1}^n\big(p_k(B_k) - p_k(B_k)^2\big).
$$

### Claim
$\{M_n,\mathcal F_n\}$ is a martingale.

### Proof

**1. Adaptedness.**  
- $X_n$ is $\mathcal F_n$-measurable, so $X_n^2$ is $\mathcal F_n$-measurable.
- Each $p_k(B_k)$ is $\mathcal F_{k-1}$-measurable, hence $\mathcal F_n$-measurable for $k\le n$.
So the sum is $\mathcal F_n$-measurable, hence $M_n$ is $\mathcal F_n$-measurable.

**2. Integrability.**  
You wrote: â€œsince $X_n$ is MG $\Rightarrow E|X_n|<\infty\Rightarrow EX_n^2<\infty$â€. That implication is not automatic. A martingale only gives $E|X_n|<\infty$, not $EX_n^2<\infty$.  
So we need a separate argument that $EX_n^2<\infty$. Luckily, it is easy here because $X_n$ is bounded by $n$ in absolute value.

As above,
$$
|X_n| \le \sum_{k=1}^n |\mathbf 1_{B_k}-p_k(B_k)|\le n
\quad\Rightarrow\quad
X_n^2 \le n^2.
$$
Hence $E[X_n^2]\le n^2 < \infty$.

Also $0\le p_k(B_k)\le 1$, so
$$
0 \le p_k(B_k) - p_k(B_k)^2 \le 1,
$$
and thus
$$
0 \le \sum_{k=1}^n\big(p_k(B_k)-p_k(B_k)^2\big)\le n.
$$

Therefore
$$
|M_n|
\le X_n^2 + \sum_{k=1}^n\big(p_k(B_k)-p_k(B_k)^2\big)
\le n^2 + n,
$$
so $E|M_n|<\infty$.

**3. Martingale property.**  
We compute $E[M_n\mid \mathcal F_{n-1}]$.

First, split the predictable sum the way the hint wants:

$$
\sum_{k=1}^n (p_k-p_k^2)
= \sum_{k=1}^{n-1} (p_k-p_k^2) + (p_n-p_n^2).
$$

The first part is $\mathcal F_{n-1}$-measurable, and the last increment $(p_n-p_n^2)$ is also $\mathcal F_{n-1}$-measurable because $p_n(B_n)\in\mathcal F_{n-1}$. So the whole sum is $\mathcal F_{n-1}$-measurable, and in particular:
$$
E\left[\sum_{k=1}^n (p_k-p_k^2)\mid\mathcal F_{n-1}\right]
= \sum_{k=1}^n (p_k-p_k^2).
$$

So the real work is the conditional expectation of $X_n^2$. Use the martingale-difference expansion you already used:

$$
X_n = X_{n-1}+D_n,\quad D_n:=X_n-X_{n-1}=\mathbf 1_{B_n}-p_n(B_n).
$$

Square and condition:

$$
X_n^2 = (X_{n-1}+D_n)^2 = X_{n-1}^2 + 2X_{n-1}D_n + D_n^2.
$$

Take $E[\cdot\mid \mathcal F_{n-1}]$:

- $X_{n-1}^2$ is $\mathcal F_{n-1}$-measurable.
- $E[D_n\mid \mathcal F_{n-1}] = 0$, so
  $$
  E[2X_{n-1}D_n\mid \mathcal F_{n-1}] = 2X_{n-1}\,E[D_n\mid \mathcal F_{n-1}] = 0.
  $$
- Compute $E[D_n^2\mid \mathcal F_{n-1}]$. Since $D_n = \mathbf 1_{B_n}-p_n$ where $p_n:=p_n(B_n)$,
  $$
  D_n^2 = (\mathbf 1_{B_n}-p_n)^2
  = \mathbf 1_{B_n} - 2p_n\mathbf 1_{B_n} + p_n^2.
  $$
  Conditioning:
  $$
  E[D_n^2\mid \mathcal F_{n-1}]
  = E[\mathbf 1_{B_n}\mid \mathcal F_{n-1}] - 2p_n E[\mathbf 1_{B_n}\mid \mathcal F_{n-1}] + p_n^2
  = p_n - 2p_n^2 + p_n^2
  = p_n - p_n^2.
  $$

Therefore
$$
E[X_n^2\mid \mathcal F_{n-1}] = X_{n-1}^2 + (p_n-p_n^2).
$$

Now plug into $M_n$:

$$
E[M_n\mid \mathcal F_{n-1}]
= E[X_n^2\mid \mathcal F_{n-1}] - \sum_{k=1}^n (p_k-p_k^2)
= \big(X_{n-1}^2 + (p_n-p_n^2)\big) - \left(\sum_{k=1}^{n-1}(p_k-p_k^2) + (p_n-p_n^2)\right)
= X_{n-1}^2 - \sum_{k=1}^{n-1}(p_k-p_k^2)
= M_{n-1}.
$$

So $\{M_n\}$ is a martingale.

### Conclusion
$\{X_n^2 - \sum_{k=1}^n (p_k(B_k)-p_k(B_k)^2),\mathcal F_n\}$ is a martingale.

### Key takeaway

- For any square-integrable martingale with differences $D_n$,
  $$
  X_n^2 - \sum_{k=1}^n E[D_k^2\mid \mathcal F_{k-1}]
  \quad\text{is a martingale.}
  $$
- Here $D_n=\mathbf 1_{B_n}-p_n$ is a â€œcentered Bernoulliâ€, so
  $$
  E[D_n^2\mid \mathcal F_{n-1}] = p_n(1-p_n)=p_n-p_n^2.
  $$
- Fix from your draft: â€œmartingale implies $EX_n^2<\infty$â€ is false in general. Here it becomes true because $X_n$ is bounded by $n$, hence in $L^2$ for each fixed $n$.

---

# Part (c)(i): $\{X_n^2,\mathcal F_n\}$ is a submartingale

### Claim
$\{X_n^2,\mathcal F_n\}$ is a submartingale.

### Proof

We already computed:
$$
E[X_n^2\mid \mathcal F_{n-1}] = X_{n-1}^2 + (p_n(B_n)-p_n(B_n)^2).
$$

But $0\le p_n(B_n)\le 1$, so
$$
p_n(B_n)-p_n(B_n)^2 = p_n(B_n)\big(1-p_n(B_n)\big)\ge 0.
$$

Therefore
$$
E[X_n^2\mid \mathcal F_{n-1}] \ge X_{n-1}^2.
$$

We also have integrability because $X_n^2\le n^2$, so $E[X_n^2]<\infty$.

Thus $\{X_n^2\}$ is a submartingale.

### Conclusion
$\{X_n^2,\mathcal F_n\}$ is a submartingale.

### Key takeaway

- A standard sufficient condition: if $X_n$ is a martingale in $L^2$, then $X_n^2$ is a submartingale because conditional variance is nonnegative.
- Here the â€œdriftâ€ of the square is exactly the conditional variance:
  $$
  E[X_n^2\mid \mathcal F_{n-1}] - X_{n-1}^2 = \operatorname{Var}(D_n\mid \mathcal F_{n-1}) = p_n(1-p_n).
  $$

---

# Part (c)(ii): Doob decomposition of $\{X_n^2,\mathcal F_n\}$

### Claim
A Doob decomposition of $\{X_n^2,\mathcal F_n\}$ is
$$
X_n^2 = M_n + A_n^{(2)},
$$
where
$$
M_n := X_n^2 - \sum_{k=1}^n (p_k(B_k)-p_k(B_k)^2)
\quad\text{is a martingale (from part (b))},
$$
and
$$
A_n^{(2)} := \sum_{k=1}^n (p_k(B_k)-p_k(B_k)^2)
\quad\text{is predictable, increasing, with }A_0^{(2)}=0.
$$

### Proof

From part (b),
$$
M_n = X_n^2 - \sum_{k=1}^n (p_k-p_k^2)
\quad\Longleftrightarrow\quad
X_n^2 = M_n + \sum_{k=1}^n (p_k-p_k^2).
$$

Define
$$
A_n^{(2)} := \sum_{k=1}^n (p_k-p_k^2).
$$

Check the Doob decomposition requirements for $A^{(2)}$:

- $A_0^{(2)}=0$.
- Increasing: each term $p_k-p_k^2 = p_k(1-p_k)\ge 0$.
- Predictable: increments satisfy
  $$
  A_n^{(2)} - A_{n-1}^{(2)} = p_n(B_n)-p_n(B_n)^2,
  $$
  which is $\mathcal F_{n-1}$-measurable since $p_n(B_n)\in\mathcal F_{n-1}$.

Thus $X_n^2 = M_n + A_n^{(2)}$ is the Doob decomposition.

### Conclusion
The Doob decomposition of $\{X_n^2\}$ is:
$$
X_n^2
= \underbrace{\left(X_n^2 - \sum_{k=1}^n (p_k(B_k)-p_k(B_k)^2)\right)}_{\text{martingale}}
+ \underbrace{\left(\sum_{k=1}^n (p_k(B_k)-p_k(B_k)^2)\right)}_{\text{predictable increasing}}.
$$

### Key takeaway

- Once you have the â€œsquare minus conditional varianceâ€ martingale, the Doob decomposition of the square is basically free: the compensator is the accumulated conditional variance.
- In this specific Bernoulli setting, the compensator is the sum of conditional Bernoulli variances:
  $$
  \sum_{k\le n} p_k(1-p_k).
  $$

---

## Meta-summary of key theorems and tricks used

- **Conditional expectation centering trick:** If $Z_n$ is $\mathcal F_n$-measurable and $E|Z_n|<\infty$, then
  $$
  Z_n - E[Z_n\mid \mathcal F_{n-1}]
  $$
  is a martingale difference.
- **Doob decomposition (discrete time):** Any integrable submartingale $S_n$ can be written as $S_n = M_n + A_n$ with $M_n$ a martingale and $A_n$ predictable increasing.
- **Square of a martingale:** With differences $D_n$, the process
  $$
  X_n^2 - \sum_{k=1}^n E[D_k^2\mid \mathcal F_{k-1}]
  $$
  is a martingale, and $X_n^2$ is a submartingale.

---

## Sources

- Original problem statement: :contentReference[oaicite:0]{index=0} (Problem 3, page 4).
- Your Mathpix draft solution: :contentReference[oaicite:1]{index=1}.
- Your handwritten PDF render: :contentReference[oaicite:2]{index=2}.
